<template>
    <div class="wrapper">
        <main>
            <header v-if="!message.success">
                <h2>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –º–µ–Ω—Ç–æ—Ä—É</h2>
                <p>–ü—Ä–∏–≤–µ—Ç! ‚úåÔ∏è</p>
                <p>–ï—Å–ª–∏ –í—ã –∑–¥–µ—Å—å, –∑–Ω–∞—á–∏—Ç –ø–æ—Ä–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é!</p>
                <p>–ü—Ä–æ–π–¥–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ–±–æ–ª—å—à–æ–π –æ–ø—Ä–æ—Å, –∑–∞–ø–æ–ª–Ω–∏–≤ –≤—Å–µ –ø–æ–ª—è –Ω–∏–∂–µ</p>
            </header>

            <form v-if="!message.success" class="fields" @submit.prevent="sendFeedback()">
                <div class="fields__item">
                    <p class="fields__item-question">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</p>
                    <p class="input_wrapper">
                        <input type="text" v-model="fields.FIO" placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è" tabindex="1">
                    </p>
                </div>

                <div class="fields__item">
                    <p class="fields__item-question">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>
                    <p class="input_wrapper">
                        <input type="text" v-model="fields.Phone" maxlength="20"
                            placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω" tabindex="2">
                    </p>
                </div>

                <div class="fields__item">
                    <p class="fields__item-question">–ï—Å—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π —É—á–µ–Ω–∏–∫?</p>
                    <div class="fields__item-column">
                        <label for="HasConstantUnit_0" tabindex="3">–ü–æ–∫–∞ –Ω–µ—Ç
                            <input type="radio" id="HasConstantUnit_0" v-model="fields.HasConstantUnit" value="–ù–µ—Ç">
                        </label>
                        <label for="HasConstantUnit_1" tabindex="4">–î–∞!
                            <input type="radio" id="HasConstantUnit_1" v-model="fields.HasConstantUnit" value="–î–∞">
                        </label>
                        <label for="HasConstantUnit_2" tabindex="5">–ë—ã–ª –ü–£, –∂–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                            <input type="radio" id="HasConstantUnit_2" v-model="fields.HasConstantUnit"
                                value="–ñ–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç">
                        </label>
                    </div>
                </div>

                <div class="fields__item"
                    v-if="fields.HasConstantUnit == '–ù–µ—Ç' || fields.HasConstantUnit == '–ñ–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç'">
                    <p class="fields__item-question">–°–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ –ø—Ä–æ–±–Ω—ã—Ö —É—Ä–æ–∫–æ–≤?</p>
                    <div class="fields__item-row">
                        <label for="CountTrialUnits_0" tabindex="6">0<input id="CountTrialUnits_0" type="radio"
                                v-model="fields.CountTrialUnits" value="0"></label>
                        <label for="CountTrialUnits_1" tabindex="7">1<input id="CountTrialUnits_1" type="radio"
                                v-model="fields.CountTrialUnits" value="1"></label>
                        <label for="CountTrialUnits_2" tabindex="8">2<input id="CountTrialUnits_2" type="radio"
                                v-model="fields.CountTrialUnits" value="2"></label>
                        <label for="CountTrialUnits_3" tabindex="9">3<input id="CountTrialUnits_3" type="radio"
                                v-model="fields.CountTrialUnits" value="3"></label>
                        <label for="CountTrialUnits_4" tabindex="10">4<input id="CountTrialUnits_4" type="radio"
                                v-model="fields.CountTrialUnits" value="4"></label>
                        <label for="CountTrialUnits_5" tabindex="11">5<input id="CountTrialUnits_5" type="radio"
                                v-model="fields.CountTrialUnits" value="5"></label>
                        <label for="CountTrialUnits_6" tabindex="12">6<input id="CountTrialUnits_6" type="radio"
                                v-model="fields.CountTrialUnits" value="6"></label>
                        <label for="CountTrialUnits_7" tabindex="13">7<input id="CountTrialUnits_7" type="radio"
                                v-model="fields.CountTrialUnits" value="7"></label>
                        <label for="CountTrialUnits_8" tabindex="14">8<input id="CountTrialUnits_8" type="radio"
                                v-model="fields.CountTrialUnits" value="8"></label>
                    </div>
                </div>

                <div class="fields__item" v-if="fields.HasConstantUnit == '–î–∞'">
                    <p class="fields__item-question">–°–∫–æ–ª—å–∫–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–µ–Ω–∏–∫–æ–≤ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç?</p>
                    <div class="fields__item-row">
                        <label for="CountConstantUnits_1" tabindex="15">1<input id="CountConstantUnits_1" type="radio"
                                v-model="fields.CountConstantUnits" value="1"></label>
                        <label for="CountConstantUnits_2" tabindex="16">2<input id="CountConstantUnits_2" type="radio"
                                v-model="fields.CountConstantUnits" value="2"></label>
                        <label for="CountConstantUnits_3" tabindex="17">3<input id="CountConstantUnits_3" type="radio"
                                v-model="fields.CountConstantUnits" value="3"></label>
                        <label for="CountConstantUnits_4" tabindex="18">4<input id="CountConstantUnits_4" type="radio"
                                v-model="fields.CountConstantUnits" value="4"></label>
                        <label for="CountConstantUnits_5" tabindex="19">5<input id="CountConstantUnits_5" type="radio"
                                v-model="fields.CountConstantUnits" value="5"></label>
                        <label for="CountConstantUnits_6" tabindex="20">6<input id="CountConstantUnits_6" type="radio"
                                v-model="fields.CountConstantUnits" value="6"></label>
                        <label for="CountConstantUnits_7" tabindex="21">7<input id="CountConstantUnits_7" type="radio"
                                v-model="fields.CountConstantUnits" value="7"></label>
                        <label for="CountConstantUnits_8" tabindex="22">8<input id="CountConstantUnits_8" type="radio"
                                v-model="fields.CountConstantUnits" value="8"></label>
                    </div>
                </div>

                <div class="fields__item" v-if="fields.HasConstantUnit == '–î–∞'">
                    <p class="fields__item-question">–°–∫–æ–ª—å–∫–æ –º–æ–¥—É–ª–µ–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É?</p>
                    <div class="fields__item-row">
                        <label for="CountPaidModules_0" tabindex="23">0<input id="CountPaidModules_0" type="radio"
                                v-model="fields.CountPaidModules" value="0"></label>
                        <label for="CountPaidModules_1" tabindex="24">1<input id="CountPaidModules_1" type="radio"
                                v-model="fields.CountPaidModules" value="1"></label>
                        <label for="CountPaidModules_2" tabindex="25">2<input id="CountPaidModules_2" type="radio"
                                v-model="fields.CountPaidModules" value="2"></label>
                        <label for="CountPaidModules_3" tabindex="26">3<input id="CountPaidModules_3" type="radio"
                                v-model="fields.CountPaidModules" value="3"></label>
                        <label for="CountPaidModules_4" tabindex="27">4<input id="CountPaidModules_4" type="radio"
                                v-model="fields.CountPaidModules" value="4"></label>
                        <label for="CountPaidModules_5" tabindex="28">5<input id="CountPaidModules_5" type="radio"
                                v-model="fields.CountPaidModules" value="5"></label>
                        <label for="CountPaidModules_6" tabindex="29">6<input id="CountPaidModules_6" type="radio"
                                v-model="fields.CountPaidModules" value="6"></label>
                        <label for="CountPaidModules_7" tabindex="30">7<input id="CountPaidModules_7" type="radio"
                                v-model="fields.CountPaidModules" value="7"></label>
                        <label for="CountPaidModules_8" tabindex="31">8<input id="CountPaidModules_8" type="radio"
                                v-model="fields.CountPaidModules" value="8"></label>
                    </div>
                </div>

                <div class="fields__item">
                    <p class="fields__item-question">–í—Å—ë –≤–µ—Ä–Ω–æ?</p>
                    <ul>
                        <li class="small mark">–° –î–∞—Ä—å–µ–π (–ö—É—Ä–∞—Ç–æ—Ä –ü–£ +375 29 386-23-91) —Å–≤—è–∑—ã–≤–∞–ª–∏—Å—å, —Å–ª–æ—Ç—ã
                            –∞–∫—Ç—É–∞–ª—å–Ω—ã!</li>
                        <li class="small mark">–í –°–†–ú –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã!</li>
                        <li class="small mark">–í —á–∞—Ç–µ "–ü–û–ò–°–ö –ü–ï–î–ê–ì–û–ì–û–í" –≤ WhatsApp –Ω–∞—Ö–æ–∂—É—Å—å</li>
                        <li class="small mark">–í —á–∞—Ç–µ "–ù–æ–≤–∏—á–∫–∏ CODDY" –≤ Telegram –Ω–∞—Ö–æ–∂—É—Å—å</li>
                        <li class="small mark">–° —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–æ–º –ü–£ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω</li>
                    </ul>
                    <div class="fields__item-column">
                        <label for="CheckInfo_0" tabindex="32">–î–∞, –≤—Å—ë –≤–µ—Ä–Ω–æ!<input type="radio" id="CheckInfo_0"
                                v-model="fields.CheckInfo" value="–í—Å—ë –≤–µ—Ä–Ω–æ"></label>
                        <label for="CheckInfo_1" tabindex="33">–ù–µ—Ç, –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å<input type="radio" id="CheckInfo_1"
                                v-model="fields.CheckInfo" value="–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å"></label>
                    </div>
                </div>

                <div class="fields__item">
                    <p class="fields__item-question">–ù–∞–≥—Ä—É–∑–∫—É?</p>
                    <div class="fields__item-column">
                        <label for="NewLoad_0" tabindex="34">–ù–∞–±–∏—Ä–∞—é!<input type="radio" id="NewLoad_0"
                                v-model="fields.NewLoad" value="–ù–∞–±–∏—Ä–∞—é"></label>
                        <p class="input_wrapper">
                            <input @click="fields.NewLoad = ''" type="text" id="NewLoad_1" v-model="fields.NewLoad"
                                placeholder="–ü–æ–∫–∞ –Ω–µ—Ç, –ø—Ä–∏—á–∏–Ω–∞:" tabindex="35">
                        </p>
                    </div>
                </div>

                <div class="fields__item">
                    <p class="fields__item-question">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –≤–æ–ø—Ä–æ—Å—ã, –ø—Ä–æ–±–ª–µ–º—ã</p>
                    <p class="input_wrapper">
                        <input type="text" v-model="fields.Comments" placeholder="–†–∞—Å—Å–∫–∞–∂–∏, –∫–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?"
                            tabindex="36"></input>
                    </p>
                </div>

                <p class="small error_message">{{ message.error }}</p>

                <nav>
                    <input type="submit" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å" tabindex="37" />
                    <input type="reset" value="–û—á–∏—Å—Ç–∏—Ç—å">
                </nav>
            </form>

            <header class="sended_success" v-if="message.success">
                <p>{{ message.success }}</p>
                <p>üíõ</p>
            </header>
        </main>
    </div>
</template>

<script>
import axios from 'axios'

export default {
    data() {
        return {
            fields: {
                FIO: '',
                Phone: '',
                HasConstantUnit: '', // –Ω–µ—Ç - –¥–∞ - –∂–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                CheckInfo: '',
                Comments: '',
                CountTrialUnits: '',
                CountConstantUnits: '',
                CountPaidModules: '',
                NewLoad: ''
            },
            message: { error: '', success: '' }
        }
    },
    watch: {
        'fields.Phone'() {
            let str = this.fields.Phone
            let rgx = /^(\+|\d)?(\d)*$/
            if (!rgx.test(str)) {
                this.fields.Phone = str.slice(0, -1)
            }
        }
    },
    mounted() {
        if (localStorage.FIO && localStorage.Phone) {
            this.fields.FIO = localStorage.FIO
            this.fields.Phone = localStorage.Phone
        }
        document.addEventListener('keydown', (event) => {
            if (event.code == 'Enter') {
                document.activeElement.click()
            }
        })
    },
    methods: {
        async sendFeedback() {
            let { FIO, Phone, HasConstantUnit, CheckInfo, Comments, CountTrialUnits, CountConstantUnits, CountPaidModules, NewLoad } = this.fields
            let FeedBack = {}
            if (FIO && Phone && CheckInfo && Comments && NewLoad && HasConstantUnit) {
                if (HasConstantUnit == '–î–∞') {
                    if (CountConstantUnits != '' && CountPaidModules != '') {
                        CountTrialUnits = 0
                        FeedBack = { FIO, Phone, CheckInfo, Comments, NewLoad, HasConstantUnit, CountConstantUnits, CountPaidModules, CountTrialUnits }
                    } else { this.message.error = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'; }
                }
                if (HasConstantUnit == '–ù–µ—Ç' || HasConstantUnit == '–ñ–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç') {
                    if (CountTrialUnits) {
                        CountConstantUnits = 0
                        CountPaidModules = 0
                        FeedBack = { FIO, Phone, CheckInfo, Comments, NewLoad, HasConstantUnit, CountTrialUnits }
                    } else { this.message.error = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'; }
                }
            } else { this.message.error = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'; }

            if (FeedBack.FIO) {
                this.message.error = ''
                await axios.post('/server/from-mentee/newFeedback', FeedBack)
                    .then((result) => {
                        this.message.success = result.data
                        localStorage.setItem('FIO', FIO);
                        localStorage.setItem('Phone', Phone);
                    })
                    .catch((error) => {
                        this.message.error = error.response.data
                    })

                console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã, —Å–ø–∞—Å–∏–±–æ!');

            }

        }
    },
}
</script>

<style scoped>
input[type="radio"] {
    display: none;
}

.wrapper {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

header {
    margin-bottom: 10px;
    padding: 10px 15px;
    background-color: var(--color_accent_lightBlue);
    color: var(--color_background-2_white);
    border-radius: 10px;
}
header.sended_success{
    text-align: center;
}
header h2 {
    margin-bottom: 6px;
}

.fields {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.fields nav {
    display: flex;
    justify-content: space-between;
}

.fields__item {
    background-color: var(--color_background-1_white);
    padding: 10px 15px;
    border-radius: 10px;
}

.fields__item-question {
    margin-bottom: 5px;
    font-weight: bold;
}

.fields__item input[type="text"],
.fields__item textarea {
    padding: 10px 5px;
    background-color: transparent;
    width: 100%;
}

.fields__item ul {
    margin: 10px 0;
}

.input_wrapper {
    position: relative;
}

.input_wrapper::before {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 1px;
    background-color: var(--color_accent_lightBlue);
}

.input_wrapper:has(input:focus)::before {
    height: 2px;
    background-color: var(--color_accent_pink);
}


.fields__item-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.fields__item label {
    transition-duration: 0.1s;
    padding: 5px;
    border-radius: 10px;
}

.fields__item-row label {
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 10px 15px;
    cursor: pointer;
    user-select: none;
}

.fields__item-column {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

label:focus,
.fields__item label:hover,
.fields__item textarea:hover {
    background: var(--color_background-2_white);
    outline-color: var(--color_accent_pink);
}

.fields__item label:has(input:checked) {
    background: var(--color_accent_pink);
}

.mark {
    padding-left: 20px;
    position: relative;
}

.mark::before {
    content: '‚úî';
    position: absolute;
    left: 0;
    color: var(--color_accent_lightBlue);
}
</style>